group 'com.brainacademy'
version '1.0-SNAPSHOT'

apply plugin: 'java'
apply plugin: 'idea'

repositories {
  mavenCentral()
}

sourceSets {
  generated {
    java {
      srcDirs = ['src/main/generated']
    }
  }
}

dependencies {
  compileOnly 'com.google.auto.service:auto-service:1.0-rc2'
  testCompile group: 'junit', name: 'junit', version: '4.12'
}

task generateQueryDSL(type: JavaCompile, group: 'build', description: 'Generates the QueryDSL query types') {
  source = sourceSets.main.java
  classpath = configurations.compile
  options.compilerArgs = [
      "-proc:only",
      "-processor", "com.brainacademy.processor.BuilderProcessor"
  ]
  destinationDir = sourceSets.generated.java.srcDirs.iterator().next()
}

compileJava {
  dependsOn generateQueryDSL
  source generateQueryDSL.destinationDir
}

compileGeneratedJava {
  dependsOn generateQueryDSL
  options.warnings = false
  classpath += sourceSets.main.runtimeClasspath
}

clean {
  delete sourceSets.generated.java.srcDirs
}

idea {
  module {
    sourceDirs += file('src/main/generated')
  }
}